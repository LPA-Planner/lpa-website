<form action="https://formspree.io/f/meolpkyv" method="POST" accept-charset="utf-8">
  <!-- meta -->
  <input type="hidden" name="_subject" value="New enquiry via lpaplanner.co.uk">
  <input type="hidden" name="_next" value="/thanks.html">
  <input type="hidden" name="service_selected" id="service_selected">

  <!-- honeypot -->
  <div style="display:none;">
    <label>Leave this blank: <input type="text" name="_gotcha" autocomplete="off"></label>
  </div>

  <!-- Core (always shown) -->
  <div class="list cols-2">
    <div>
      <label for="name">Your name</label>
      <input id="name" name="name" type="text" required autocomplete="name">
    </div>
    <div>
      <label for="email">Email</label>
      <input id="email" name="email" type="email" required autocomplete="email">
    </div>
  </div>

  <div class="list cols-2" style="margin-top:1rem;">
    <div>
      <label for="authority">Local authority (optional)</label>
      <input id="authority" name="local_authority" type="text" placeholder="e.g., Southwark">
    </div>
    <div>
      <label for="site">Site address (optional)</label>
      <input id="site" name="site_address" type="text">
    </div>
  </div>

  <div style="margin-top:1rem;">
    <label for="service">Which service are you interested in?</label>
    <select id="service" name="service" required>
      <option value="" disabled selected>Select one…</option>
      <option value="quick">Quick Review (£50)</option>
      <option value="document">Document Review (£100)</option>
      <option value="appeal">Appeal Submission (£500+)</option>
      <option value="unsure">Unsure – please advise</option>
    </select>
  </div>

  <div style="margin-top:1rem;">
    <label for="summary">Brief summary</label>
    <textarea id="summary" name="summary" rows="6" required placeholder="What’s happened so far and what outcome you’re after."></textarea>
  </div>

  <!-- Conditional: Quick Review -->
  <fieldset id="section-quick" style="display:none; margin-top:1rem;">
    <legend>Quick Review details</legend>
    <label>Desired outcome <input name="quick_desired_outcome" type="text"></label>
    <label style="display:block; margin-top:.5rem;">Have you contacted the council?
      <select name="quick_contacted_council">
        <option value="">—</option><option>Yes</option><option>No</option>
      </select>
    </label>
    <label style="display:block; margin-top:.5rem;">Urgency
      <select name="quick_urgency">
        <option value="">—</option><option>Not urgent</option><option>Soon</option><option>Time-critical</option>
      </select>
    </label>
  </fieldset>

  <!-- Conditional: Document Review -->
  <fieldset id="section-document" style="display:none; margin-top:1rem;">
    <legend>Document Review details</legend>
    <label style="display:block;">Document type
      <select name="doc_type">
        <option value="">—</option>
        <option>Refusal</option><option>Enforcement Notice</option>
        <option>Breach of Condition Notice</option><option>Planning Contravention Notice</option>
        <option>Warning letter</option><option>Other</option>
      </select>
    </label>
    <label style="display:block; margin-top:.5rem;">Council reference(s) <input name="doc_refs" type="text"></label>
    <label style="display:block; margin-top:.5rem;">Date on document <input name="doc_date" type="date"></label>
    <label style="display:block; margin-top:.5rem;">Top 1–2 concerns <input name="doc_focus" type="text" placeholder="What should I focus on?"></label>
    <!-- If you later enable file upload via Formspree/plan, add: <input type="file" name="doc_file"> -->
  </fieldset>

  <!-- Conditional: Appeal Submission -->
  <fieldset id="section-appeal" style="display:none; margin-top:1rem;">
    <legend>Appeal Submission details</legend>
    <label style="display:block;">Appeal type
      <select name="appeal_type">
        <option value="">—</option>
        <option>Planning application refusal</option>
        <option>Enforcement appeal</option>
        <option>Other</option>
      </select>
    </label>
    <label style="display:block; margin-top:.5rem;">Decision/Notice date <input name="appeal_date" type="date"></label>
    <label style="display:block; margin-top:.5rem;">Appeal/reference numbers <input name="appeal_refs" type="text"></label>
    <label style="display:block; margin-top:.5rem;">Scale/complexity
      <select name="appeal_scale">
        <option value="">—</option><option>Householder</option><option>Small commercial</option><option>Larger / multi-issue</option>
      </select>
    </label>
    <label style="display:block; margin-top:.5rem;">Deadlines mentioned by council <input name="appeal_deadlines" type="text"></label>
  </fieldset>

  <div style="margin-top:1rem;">
    <label class="checkbox">
      <input type="checkbox" name="consent" required>
      I consent to being contacted about this enquiry and confirm I’ve read the <a href="/privacy.html">privacy notice</a>.
    </label>
  </div>

  <button type="submit" style="margin-top:1rem;">Send enquiry</button>
</form>

<script>
  (function() {
    const select = document.getElementById('service');
    const hidden = document.getElementById('service_selected');
    const sections = {
      quick: document.getElementById('section-quick'),
      document: document.getElementById('section-document'),
      appeal: document.getElementById('section-appeal')
    };

    function showSection(val) {
      Object.values(sections).forEach(el => el && (el.style.display = 'none'));
      if (sections[val]) sections[val].style.display = '';
      hidden.value = val || '';
    }

    // preselect from ?service=quick|document|appeal
    const params = new URLSearchParams(location.search);
    const pre = params.get('service');
    if (pre && ['quick','document','appeal','unsure'].includes(pre)) {
      select.value = pre;
      showSection(pre);
    }

    select.addEventListener('change', e => showSection(e.target.value));
  })();
</script>
